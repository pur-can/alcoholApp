<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width = device-width, initial-scale = 1">
    <title>app</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Noto+Sans+JP:400,700" rel="stylesheet">
  </head>
  <body>
    <header class="top-head">
      <div>
        <a href="/setting"><i class="fas fa-cog"></i></a>
        本日の飲酒量
      </div>
      <a href="/register" class="add">追加 +</a>
      
    </header>
    <section class="main1">
      <div class="content">
        
        <% 
          try {
            var ml = 0;
            var value = 0;
            var kcal = 0;
            var alcoholTime = 0;
            var alcoholg;
            var alcoholism = 0;
            
            alcohols.forEach(function (alcohol) {
              alcoholg = alcohol.ml * alcohol.percent / 100 * 0.8;
              alcoholTime += Math.round((alcoholg / (alcohol.weight / 10)) * 100)/ 100;
              alcoholism += (alcohol.ml * alcohol.percent) / (833 * alcohol.weight);
              ml += alcohol.ml;
              value += alcohol.value;
              kcal += alcohol.kcal;
            });

            var summl = ml;
            var sumvalue = value;
            var sumkcal = kcal;
            
            var now = new Date().getTime();
            var firstAlcohol = new Date(alcohols[0].uptime);
            alcoholTime -= Math.round((((now - firstAlcohol) / 1000) / 3600) * 100)/ 100;
          } catch(e) {
            console.log(e.message);
          }
        %>
        <div>
          <p>総飲酒量<p><span class="big"><%= summl %></span> ml</p></p>
        </div>
        <div>
          <p>総額<p><span class="big"><%= sumvalue %></span> 円</p></p>
        </div>
        <div>
          <p>総カロリー量<p><span class="big"><%= sumkcal %></span> kcal</p></p>
        </div>

      </div>
      <div class="img">
        <% if (alcoholism < 0.11) { %>
          <p>ほろ酔い期</p>
          <img src="../images/horoyoi.png">
        <% } else if (alcoholism < 0.31) { %>
          <p>酩酊期</p>
          <img src="../images/meitei.png">
        <% } else if (alcoholism < 0.41) { %>
          <p>泥酔期</p>
          <img src="../images/deisui.png">
        <% } else { %>
          <p>死</p>
          <img src="">
        <% } %>
      </div>
    </section>
    <section class="main2">
      <p class="main2p">アルコールが抜けるまで…約<span class="big"><%= alcoholTime %></span>時間</p>
      <% try { %>
        <p>（<%= firstAlcohol.getDate() %>日<%= firstAlcohol.getHours() %>時<%= firstAlcohol.getMinutes() %>分から計算)</p>
      <% } catch(e) { console.log(e.message); }%>

      

    </section>
    <form action="/timeend" method="post"><input type="submit" class="buttonA" value="飲み終わる"></form>
    <section>
      <div class="container">
        <div class="index-table-wrapper">
          <div class="table-head">
            <span class="id-column">ID</span>
            <span class="type-column">種類</span>
            <span class="ml-column">ml</span>
            <span class="value-column">価格</span>
            <span class="kcal-column">kcal</span>
          </div>
          <ul class="table-body">
            <% alcohols.forEach(function(alcohol) { %>
              <li>
                <div class="item-data">
                  <span class="id-column"><%= alcohol.id %></span>
                  <span class="type-column"><%= alcohol.type %></span>
                  <span class="ml-column"><%= alcohol.ml %></span>
                  <span class="value-column"><%= alcohol.value %></span>
                  <span class="kcal-column"><%= alcohol.kcal %></span>
                </div>
                <div class="item-menu">
                  <form action="/delete/<%= alcohol.id %>" method="post">
                    <input type="submit" value="削除">
                  </form>
                </div>
              </li>
            <% }) %>
          </ul>
        </div>
      
      </div>
    </section>
    <footer></footer>
  </body>
</html>